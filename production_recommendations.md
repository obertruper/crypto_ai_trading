# üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

## üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º

### 1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±—É—á–µ–Ω–∏–µ–º**:
- **Direction Accuracy –∑–∞—Å—Ç—Ä—è–ª–∞ –Ω–∞ ~33%** (—Å–ª—É—á–∞–π–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è 3 –∫–ª–∞—Å—Å–æ–≤)
- **Win Rate ~42%** (–Ω–∏–∂–µ 50% - –º–æ–¥–µ–ª—å —É–±—ã—Ç–æ—á–Ω–∞)
- **–ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ**: train loss –ø–∞–¥–∞–µ—Ç (2.2), –Ω–æ val loss —Ä–∞—Å—Ç–µ—Ç (2.8)
- **–î–∏—Å–±–∞–ª–∞–Ω—Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π**: –º–æ–¥–µ–ª—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç SHORT (46-60%)

### 2. **–ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. **–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π batch size (8192)** - —Å–≥–ª–∞–∂–∏–≤–∞–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã
2. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ –∫–ª–∞—Å—Å–æ–≤** - –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
3. **–°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π learning rate (0.001)** –¥–ª—è —Ç–∞–∫–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ –±–∞—Ç—á–∞
4. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è** - dropout 0.3 –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
5. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è warmup** –¥–ª—è direction loss

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 1. **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ config.yaml**:

```yaml
model:
  # –£–º–µ–Ω—å—à–∞–µ–º batch size –¥–ª—è –ª—É—á—à–∏—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤
  batch_size: 1024  # –ë—ã–ª–æ 8192 - —É–º–µ–Ω—å—à–∞–µ–º –≤ 8 —Ä–∞–∑
  
  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—é
  dropout: 0.5  # –ë—ã–ª–æ 0.3
  weight_decay: 0.01  # –ë—ã–ª–æ 0.0001
  
  # –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º learning rate
  learning_rate: 0.0001  # –ë—ã–ª–æ 0.001 - —É–º–µ–Ω—å—à–∞–µ–º –≤ 10 —Ä–∞–∑
  warmup_steps: 2000  # –ë—ã–ª–æ 1000
  
  # –£–ª—É—á—à–∞–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
  d_model: 256  # –ë—ã–ª–æ 512 - —É–ø—Ä–æ—â–∞–µ–º –º–æ–¥–µ–ª—å
  d_ff: 512  # –ë—ã–ª–æ 1024
  
  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º label smoothing
  label_smoothing: 0.2  # –ë—ã–ª–æ 0.1
  
  # –û—Ç–∫–ª—é—á–∞–µ–º mixup (–º–æ–∂–µ—Ç –º–µ—à–∞—Ç—å)
  mixup_alpha: 0.0  # –ë—ã–ª–æ 0.2
  
  # Gradient accumulation –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞—Ç—á–∞
  gradient_accumulation_steps: 8  # –ë—ã–ª–æ 2, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π batch = 8192

loss:
  # –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –≤–µ—Å–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
  task_weights:
    future_returns: 0.5  # –ë—ã–ª–æ 1.0 - —É–º–µ–Ω—å—à–∞–µ–º –≤–ª–∏—è–Ω–∏–µ
    directions: 10.0  # –ë—ã–ª–æ 5.0 - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
    long_levels: 0.5  # –ë—ã–ª–æ 1.0
    short_levels: 0.5  # –ë—ã–ª–æ 1.0
    risk_metrics: 0.2  # –ë—ã–ª–æ 0.5
  
  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ç—Ä–∞—Ñ—ã
  wrong_direction_penalty: 5.0  # –ë—ã–ª–æ 2.0
  large_move_weight: 10.0  # –ë—ã–ª–æ 5.0
  
  # Focal loss –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º
  focal_alpha: 0.5  # –ë—ã–ª–æ 0.25
  focal_gamma: 3.0  # –ë—ã–ª–æ 2.0

scheduler:
  name: CosineAnnealingWarmRestarts  # –ò–∑–º–µ–Ω—è–µ–º scheduler
  params:
    T_0: 10  # –ü–µ—Ä–∏–æ–¥ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
    T_mult: 2  # –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞
    eta_min: 1e-6  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π LR
```

### 2. **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ –º–æ–¥–µ–ª–∏**:

```python
# –í models/patchtst_unified.py - —É–ª—É—á—à–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤–µ—Å–æ–≤ –¥–ª—è direction head
def _init_weights(self):
    # –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º
    if 'direction_head' in name:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –±—ã–ª–∏ –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º–∏
        bias[:, 0] = 0.5    # LONG bias (—É–≤–µ–ª–∏—á–µ–Ω)
        bias[:, 1] = 0.3    # SHORT bias (—É–º–µ–Ω—å—à–µ–Ω)
        bias[:, 2] = -0.8   # FLAT bias (—Å–∏–ª—å–Ω–æ —É–º–µ–Ω—å—à–µ–Ω)
```

### 3. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—É—á–µ–Ω–∏—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤**:

#### –≠—Ç–∞–ø 1: –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (5-10 —ç–ø–æ—Ö)
```python
# –°–æ–∑–¥–∞—Ç—å —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç
from imblearn.over_sampling import SMOTE
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å weighted sampling –≤ DataLoader
```

#### –≠—Ç–∞–ø 2: Fine-tuning –Ω–∞ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (20-30 —ç–ø–æ—Ö)
```python
# –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∞—Ç—å –≤–µ—Å–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å curriculum learning
```

#### –≠—Ç–∞–ø 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ (10-20 —ç–ø–æ—Ö)
```python
# –§–æ–∫—É—Å –Ω–∞ win rate –∏ profit factor
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å trading-specific loss
```

### 4. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**:

1. **–ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**:
   - –î–æ–±–∞–≤–∏—Ç—å —à—É–º –∫ –≤—Ö–æ–¥–Ω—ã–º –¥–∞–Ω–Ω—ã–º
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å temporal mixup
   - –°–ª—É—á–∞–π–Ω–æ–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

2. **–ê–Ω—Å–∞–º–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –û–±—É—á–∏—Ç—å 3-5 –º–æ–¥–µ–ª–µ–π —Å —Ä–∞–∑–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å voting –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

3. **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞**:
   - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π (Platt scaling)
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ confidence > 0.7

### 5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è**:

```python
# –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- Precision/Recall –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞
- Confusion matrix
- Trading-specific –º–µ—Ç—Ä–∏–∫–∏ (Sharpe, Calmar)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
```

### 6. **–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è**:

```bash
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
python validate_config.py

# –ó–∞–ø—É—Å–∫ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
python main.py --mode train \
    --batch-size 1024 \
    --learning-rate 0.0001 \
    --epochs 50 \
    --early-stopping-patience 20 \
    --gradient-accumulation 8 \
    --log-level DEBUG

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tensorboard --logdir experiments/tensorboard/
```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

1. **Direction Accuracy**: 45-55% (—É–ª—É—á—à–µ–Ω–∏–µ —Å 33%)
2. **Win Rate**: 52-58% (—É–ª—É—á—à–µ–Ω–∏–µ —Å 42%)
3. **Entropy**: —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –æ–∫–æ–ª–æ 0.9-1.0
4. **Val Loss**: —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö** - –≤–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ –≤ –º–µ—Ç–∫–∞—Ö
2. **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è** - –≥–¥–µ –∏–º–µ–Ω–Ω–æ –º–æ–¥–µ–ª—å –æ—à–∏–±–∞–µ—Ç—Å—è
3. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å—Ä–∞–≤–Ω–∏—Ç—å —Å baseline –º–æ–¥–µ–ª—å—é
4. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ** - –Ω–∞—á–∞—Ç—å —Å –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π

## üìà –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:

1. **–ù–µ–¥–µ–ª—è 1**: –û–±—É—á–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
2. **–ù–µ–¥–µ–ª—è 2**: –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ù–µ–¥–µ–ª—è 3**: Paper trading (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥)
4. **–ù–µ–¥–µ–ª—è 4**: –ó–∞–ø—É—Å–∫ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
5. **–ú–µ—Å—è—Ü 2**: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π