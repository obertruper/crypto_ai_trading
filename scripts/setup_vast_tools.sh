#!/bin/bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ Vast.ai —Å–µ—Ä–≤–µ—Ä–µ

# –¶–≤–µ—Ç–∞
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ Vast.ai —Å–µ—Ä–≤–µ—Ä–µ${NC}"

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
HOST="ssh1.vast.ai"
PORT="30421"
KEY_PATH="$HOME/.ssh/id_rsa"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–ª—é—á–∞
if [ ! -f "$KEY_PATH" ]; then
    echo -e "${RED}‚ùå SSH –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω: $KEY_PATH${NC}"
    exit 1
fi

# SSH –∫–æ–º–∞–Ω–¥–∞
SSH_CMD="ssh -p $PORT -i $KEY_PATH root@$HOST"

echo -e "\n${YELLOW}üì¶ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤...${NC}"

$SSH_CMD << 'REMOTE_COMMANDS'
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
echo "üìã –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∞–∫–µ—Ç–æ–≤..."
apt-get update -qq

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ tmux
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ tmux..."
apt-get install -y tmux

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ screen –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ screen..."
apt-get install -y screen

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ htop –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ htop..."
apt-get install -y htop

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ncdu –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∏—Å–∫–∞
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ncdu..."
apt-get install -y ncdu

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ git –µ—Å–ª–∏ –Ω–µ—Ç
echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ git..."
if ! command -v git &> /dev/null; then
    apt-get install -y git
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nvtop –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ GPU
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nvtop..."
apt-get install -y nvtop || echo "nvtop –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–µ–∑–Ω—ã—Ö –∞–ª–∏–∞—Å–æ–≤
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–∏–∞—Å–æ–≤..."
cat >> ~/.bashrc << 'EOF'

# –ü–æ–ª–µ–∑–Ω—ã–µ –∞–ª–∏–∞—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GPU
alias gpu='nvidia-smi'
alias gpuw='watch -n 1 nvidia-smi'
alias tl='tmux ls'
alias ta='tmux attach -t'
alias tn='tmux new -s'
alias logs='tail -f ~/crypto_ai_trading/logs/training_gpu.log'
alias cdcrypto='cd ~/crypto_ai_trading'

EOF

echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üéØ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:"
echo "   ‚Ä¢ tmux - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏"
echo "   ‚Ä¢ screen - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ tmux"
echo "   ‚Ä¢ htop - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
echo "   ‚Ä¢ ncdu - –∞–Ω–∞–ª–∏–∑ –¥–∏—Å–∫–∞"
echo "   ‚Ä¢ nvtop - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)"
echo ""
echo "üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "   ‚Ä¢ tmux new -s training - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é"
echo "   ‚Ä¢ tmux attach -t training - –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Å—Å–∏–∏"
echo "   ‚Ä¢ Ctrl+B, D - –æ—Ç–∫–ª—é—á–∏—Ç—å—Å—è –æ—Ç tmux —Å–µ—Å—Å–∏–∏"
echo "   ‚Ä¢ gpu - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å GPU"
echo "   ‚Ä¢ gpuw - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"
echo "   ‚Ä¢ logs - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ–±—É—á–µ–Ω–∏—è"

REMOTE_COMMANDS

echo -e "\n${GREEN}‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}"
echo -e "${YELLOW}–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ run_interactive.py${NC}"