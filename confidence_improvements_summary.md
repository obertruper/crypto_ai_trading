# üìä –†–µ–∑—é–º–µ —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º Loss

### –ü—Ä–æ–±–ª–µ–º–∞:
- Loss —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –Ω–∞—á–∏–Ω–∞—è —Å —ç–ø–æ—Ö–∏ 6 (–¥–æ—Å—Ç–∏–≥–∞–ª -10 –º–∏–ª–ª–∏–æ–Ω–æ–≤)
- –ú–æ–¥–µ–ª—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∞—Å—å –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è—Ö: 25% LONG, 50% SHORT, 25% FLAT
- –≠–Ω—Ç—Ä–æ–ø–∏—è –ø–∞–¥–∞–ª–∞ –¥–æ 0 (overconfident –Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

### –ü—Ä–∏—á–∏–Ω–∞:
- BCEWithLogitsLoss –¥–ª—è confidence –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ö–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –æ—á–µ–Ω—å —É–≤–µ—Ä–µ–Ω–∞ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è—Ö, loss –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è
- Confidence –ª–æ–≥–∏—Ç—ã –Ω–µ –±—ã–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –∏ –º–æ–≥–ª–∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Confidence –≤—ã—Ö–æ–¥–æ–≤:
```python
# –ë—ã–ª–æ:
self.confidence_head = nn.Sequential(
    ...,
    nn.Linear(self.d_model // 2, 4)  # –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ª–æ–≥–∏—Ç—ã
)

# –°—Ç–∞–ª–æ:
self.confidence_head = nn.Sequential(
    ...,
    nn.Linear(self.d_model // 2, 4),
    nn.Tanh()  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Ö–æ–¥ –≤ [-1, 1]
)
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ Loss —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å autocast:
```python
# –ë—ã–ª–æ:
confidence_loss = F.binary_cross_entropy_with_logits(
    confidence_scores,  # –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ª–æ–≥–∏—Ç—ã
    correct_predictions
)
losses.append(confidence_loss * 0.5)

# –°—Ç–∞–ª–æ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è):
# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [-1, 1]
confidence_targets = correct_predictions * 2 - 1  # –ò–∑ [0, 1] –≤ [-1, 1]

# MSE loss –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è autocast
confidence_loss = F.mse_loss(
    confidence_scores,      # –í—ã—Ö–æ–¥ Tanh: [-1, 1]
    confidence_targets,     # –¶–µ–ª–∏: [-1, 1]
    reduction='mean'
)
losses.append(confidence_loss * 0.1)  # –£–º–µ–Ω—å—à–∏–ª–∏ –≤–µ—Å —Å 0.5 –¥–æ 0.1
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ç–∏–ª–∏—Ç:
- `confidence_filter.py`: –∏–∑–º–µ–Ω–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ confidence scores
- `optimized_trainer.py`: –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ confidence –º–µ—Ç—Ä–∏–∫

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–°—Ç–∞–±–∏–ª—å–Ω—ã–π Loss**: –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
2. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å autocast**: MSE loss —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Mixed Precision Training
3. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å**: Tanh –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
4. **–õ—É—á—à–∏–π –±–∞–ª–∞–Ω—Å**: —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–π –≤–µ—Å confidence loss (0.1) –Ω–µ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç
5. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ**: –º–æ–¥–µ–ª—å –Ω–∞—É—á–∏—Ç—Å—è –∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
6. **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è confidence**: -1 = –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω—ã–π/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, +1 = —É–≤–µ—Ä–µ–Ω–Ω—ã–π/–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å loss - –æ–Ω –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º
3. –°–ª–µ–¥–∏—Ç—å –∑–∞ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π (—ç–Ω—Ç—Ä–æ–ø–∏—è > 0.3)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ confidence scores

## üìä –í—Å–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ú–µ—Ö–∞–Ω–∏–∑–º—ã –ø–æ–≤—ã—à–µ–Ω–∏—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:
1. ‚úÖ **Temperature Scaling** - –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
2. ‚úÖ **Label Smoothing** (0.1) - —É–ª—É—á—à–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏–∏
3. ‚úÖ **Confidence Head** - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
4. ‚úÖ **Dropout Schedule** - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ dropout
5. ‚úÖ **Mixup Augmentation** - –¥–ª—è direction –∑–∞–¥–∞—á–∏
6. ‚úÖ **Confidence-aware Loss** - –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ –ø–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
7. ‚úÖ **Focal Loss** - –¥–ª—è –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
8. ‚úÖ **Dynamic Direction Weight** - warmup –¥–ª—è direction loss

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ config.yaml:
```yaml
label_smoothing: 0.1
mixup_alpha: 0.2
temperature_scaling: true
confidence_threshold: 0.6
dropout_schedule: true
early_stopping_patience: 50
```

## üéØ –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
```bash
python main.py --mode train
```